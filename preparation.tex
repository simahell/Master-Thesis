\documentclass[12pt,a4paper]{jbook}
\input{settings}
\begin{document}
\newpage

\chapter{準備}
\section{形式手法}
\subsection{概要}
一般に産業界においてシステムの安全性を検査する際には、作成したシステムに実際に様々な入力を与えて動作を確認する方法（シミュレーション）を採用することが多い。
この方法は検査に別途必要となるものがなく低コストで実施できるため、広く使用される方法である。
しかし、この方法ではシミュレーションに使用する入力を人が考えるため、想定外の入力に対する動作における不具合が残る可能性が高くなる。
つまり、シミュレーションによる検査ではシステムを本来の用途で運用する際の不具合を検出することができるが、
漏れのない検査結果を得ることができない。

一方で、システムの安全性検査には形式手法と呼ばれる、数学的な証明を利用する方法がある。
この方法では、入力となるセキュリティモデル（\ref{sec:SecurityModel}節参照）を作成し、専用の形式手法ツールを実行することでシステムが安全かどうかの結果を得ることができる。

実際にシステム開発に形式手法を利用する際には、以下の三つのステップの手順を繰り返し行う。
\begin{enumerate}
\item モデル作成\\
設計したシステムをセキュリティモデル（\ref{sec:SecurityModel}節参照）として表現する。
\item ツール実行\\
用意したセキュリティモデルを入力として形式手法ツールを実行し、設計の漏れや仕様上の不具合を検出する。
\item モデル修正\\
2.で検出された漏れや不具合を参考にシステムの設計を見直し、その修正をセキュリティモデルに適用する。
\end{enumerate}

\subsection{Alloy Analyzer}
Alloy Analyzerは形式手法による解析ツールの一つである。
検査対象のシステムのモデルをAlloyという専用の言語で記述し、これを入力として実行する。
その結果としては二通りの出力を得ることができる。
まずは、そのシステムが設計上取りうる状態の例が表示され、これを利用することでシステムが設計者の意図していない挙動を行っていないかを確認でき、設計上の漏れを防ぐことができる。
また、要件を満たさない状態を検索することも可能であり、これによりシステムが設計通りに動作したとしても危険な状態に陥ってしまうような不具合を見つけることができる。

また、Alloy Analyzerが他の形式手法ツールとは異なる点として、実行結果をグラフとして得られるため、より直観的な利用が可能であることが挙げられる。
さらに、Alloy AnalyzerはJavaを用いて実装されており、環境の構築はJavaのインストールのみで利用することができる。

\subsection{時相論理}
\label{sec:TemporalLogic}
%\subsubsection{概要}
時相論理は通常の命題論理に「常に～である」「次の状態では～である」のような、いくつかの論理演算子を加えることで時間変化を表現できるよう、拡張したものである。
時相論理において記述した論理式は、その性質から以下の二種類に分類できる。
\begin{itemize}
\item 状態論理式\\
状態論理式はモデルが取りうる各状態に対して真偽が定まる
\item パス論理式\\
パスはそのモデルにおいて状態が変化していく遷移を表す。
パス論理式はモデルが取りうるパスに対して真偽が定まる。
\end{itemize}

また、時相論理にもいくつか種類が存在し、それぞれで扱える演算子が異なるため表現能力が異なる。
以下に形式手法に用いられる三つの時相論理を挙げる。
\begin{itemize}
\item LTL（linear temporal logic / 線形時相論理）\\
LTLはパス論理式のみを表現可能である。
\item CTL（compuational tree logic / 計算木論理）\\
CTLは状態論理式のみを表現可能である。
\item CTL*\\
CTL*はパス論理式、及び、状態論理式のどちらも表現可能である。
また、上記のLTLとCTLはCTL*の部分論理である。
\end{itemize}

\section{World Wide Web}
World Wide Web（以下、「ウェブ」とする）はインターネットにおいてHTMLで記述されているドキュメントのサービスを提供するシステムである。
このHTMLはハイパーテキストを記述するための言語であり、ハイパーテキストとはあるドキュメント内に別のドキュメントへのリンクを埋め込み、ドキュメント間の関連性を表現可能とする技術である。
また、ウェブにおいてはそのリンクを用いてインターネットに存在する様々なドキュメントの繋がりを表現し、参照先のドキュメントの表示やダウンロードを容易にする。
また、この利便性に加えて、ウェブを利用するためのソフトウェアであるブラウザや検索エンジンの技術向上により、ウェブは急速に普及し現代社会において不可欠なものとなっている。

\section{キャッシュ}
\subsection{概要}
一般的にキャッシュには二つの意味があり、パソコン内の部品で処理速度の向上が目的のキャッシュメモリか、もしくはウェブの分野においてブラウザやサーバ等が通信内容を一時的に保存するキャッシュ機能のことを指す。
これらのうち本研究では、後者のウェブにおけるキャッシュについて取り扱う。

以前は、そもそものウェブの通信速度が遅く通信の最大容量が小さかったため、いかに少ない通信量で効率良く通信を行うかが求められていた。
そこで、画像や動画等のウェブページに埋め込まれているデータの中には頻繁に更新されないものが存在し、それらに関しては毎回通信を行う必要がないと考えられた。
そういったデータについて最初にリクエストを行った際にそのレスポンスを保存しておき、以降同様のデータに対するリクエストにはその保存されているレスポンスを再利用して応答することで、通信量と通信速度ともに向上させることができる。

また、キャッシュの制御は主にリクエストとレスポンスに含まれるヘッダを用いて行い、例えば、キャッシュの利用の不可や検証動作の強制といった指定が可能である。

\subsection{キャッシュの基本動作}
キャッシュには、「格納」「再利用」「検証」の大きく三つの基本的な機能が存在する。

\begin{enumerate}
\item 格納\\
キャッシュを保有する機器が、レスポンスの再利用を目的としてキャッシュに一時保存することを「格納」という。
キャッシュに保存された場合の有効期限がヘッダに明記されており、かつ、保存を許さないといった記述がない場合に、キャッシュにそのレスポンスを格納することができる。
\item 再利用\\
キャッシュを持つ通信者がリクエストを生成しようとする場合、もしくは、リクエストを受信した場合に、そのリクエストが求めるリソースがキャッシュに格納されているレスポンスに含まれており、キャッシュによるレスポンスの再利用を禁止する記述がない場合、その通信者はその格納レスポンスを複製し応答として利用できる。
有効期限が切れている場合や、検証が強制されている場合には後述の検証動作を行う必要がある。
\item 検証\\
キャッシュ内のレスポンスが現在も再利用可能であるかをオリジンサーバ（そのレスポンスの生成元であるサーバ）に問い合わせる動作を「検証」という。
その問い合わせは、専用のヘッダを含む「条件付きリクエスト」を生成することで行う。
この条件付きリクエストに対するレスポンスとして、再利用可能であることを表すレスポンス、もしくは、再度キャッシュに格納するための最新のレスポンスを受け取ることができる。
\end{enumerate}

\subsection{キャッシュを利用する攻撃}
キャッシュを利用した攻撃の一例としてBrowser Cache Poisoning攻撃（以下、「BCP攻撃」とする）\cite{bcpattack}を取り上げる。
BCP攻撃はクライアントとサーバの経路上に攻撃者である第三者が割り込んで行う、中間者攻撃に該当する。
このBCP攻撃の基本的な手順は以下の通りである。
\begin{enumerate}
\item 攻撃者はクライアントとサーバ間の通信経路上に割り込む
\item サーバからクライアントへ送信されるレスポンスのヘッダとリソースを書きかえる
\item 通信経路上のキャッシュ（クライアントもしくは中継者のキャッシュ）にその書き換えたレスポンスを格納させる
\item 今後、クライアントはそのリソースを使用しようとする度にキャッシュによる再利用が発生し、攻撃者によって書き換えられたリソースを受け取ることになる
\end{enumerate}

BCP攻撃の特徴は、まず攻撃者が実際に行動するのはレスポンスの書き換えを行う一度きりであるのに対し、その影響は以降の通信全てに影響することである。
また、攻撃が可能な対象が通信プロトコルの一つのHTTP（\ref{sec:http}章参照）や、暗号通信プロトコルHTTPS（\ref{sec:https}節参照）である。
これらは現在広くウェブで使用されておりBCP攻撃の危険性は高くなっている一方で、このBCP攻撃の対策法は固まっておらず速やかな解析が求められている。

\section{Hypertext Transfer Protocol}
\label{sec:http}
\subsection{プロトコルの概要}
Hypertext Transfer Protocol（以下、「HTTP」とする）は様々なデータの形式や通信目的に共通して対応できる汎用的な通信を実現するためのプロトコルとして設計された。
このHTTPは、ウェブの環境に合わせて仕様変更がなされており様々なバージョンが存在する。
本研究では、現在一般的に使用されることが多いHTTP/1.1\cite{rfc7230,rfc7231,rfc7232,rfc7233,rfc7234,rfc7235}と、その下位互換性を考慮しHTTP/1.0\cite{rfc1945}を対象に考える。

HTTPにおける基本的な通信は、クライアントから発信されるリクエストとサーバからのレスポンスの二段階の通信で成り立つ。
まず、クライアントは要求するリソースを指定したリクエストを、対象のリソースを所有するサーバに送信する。
そして、リクエストを受信したサーバは対象のリソースを含めたレスポンスをクライアントに送信することで、クライアントは要求したリソースを取得することができる。

また、HTTPのプロトコルは汎用的な利用を目的とするため、プロトコル上で定義される内容は以下の三つである。
\begin{itemize}
\item 通信内容の構文
\item 通信内容の利用意図
\item 通信相手に期待するふるまい
\end{itemize}
送信者は定義された構文に従いパケットを生成し送信することで、通信の意図と通信相手に期待する動作を伝えることができ、受信者はこれに伴ったふるまいをとることができる。
さらに、このように単純な設計にしておくことで、HTTP以外の異なるプロトコル間での通信を継げるといった利用方法も可能となる。

\subsection{HTTP通信を構成する要素}
HTTPの通信を行うプログラムには様々な役割があり、それらは役割ごとに「クライアント」「サーバ」「中継者」の三種類に分類される。
また、複数の通信が並行して行われているような場合には同時に複数の役割を果たしていることもあり、同一のプログラムがある接続ではサーバ、他の接続においてはクライアントとして動作することもありうる。

\subsubsection{クライアント}
HTTPにおけるクライアントは、リクエストを送信するためにサーバへの接続を確立するプログラムのことを指す。
一般的には、ウェブブラウザやスマートフォンなどのウェブアプリケーションがこの役割を果たすことが多い。

\subsubsection{サーバ}
HTTPにおけるサーバは、受信したリクエストに対して要求されたふるまいを行い結果をレスポンスとしてクライアントへ送信するプログラムのことを指す。
サーバとして動作しているプログラムはその性質上、企業などのサービス提供者が運用している場合が多い。

\subsubsection{中継者}
\label{sec:intermediary}
HTTP通信ではクライアントとレスポンスの経路間で複数のプログラムを経由する場合があり、このプログラムを中継者と呼ぶ。
中継者にも様々な機能が存在し、それらに合わせて三つの種類がある。
\begin{enumerate}
\item プロキシ\\
プロキシは通過するリクエストやレスポンスを編集することができ、通信内容を事前に指定した形式へ変換したり、許可されていない内容を削除するといった機能を持つ。
また、ある組織に属する複数のクライアントで共通のプロキシを利用することで、セキュリティの向上やキャッシュを用いた通信の効率化を実現することも可能である。
\item ゲートウェイ\\
ゲートウェイはローカルネットワークとグローバルネットワークの経由地点として機能する。
まず、ゲートウェイはグローバルネットワーク側から見るとサーバとしてふるまい、リクエストを受信する。
それらのリクエストに対して、ローカルネットワーク側からはクライアントとしてふるまい、ローカルネットワーク内の複数のサーバから最適なサーバに対してリクエストを送信する。
最後に、ローカルネットワークから得られた結果を踏まえてレスポンスを作成し、グローバルネットワークの本来のリクエストの送信元に対して返答する。
このゲートウェイに仕組みを利用することで、サーバの処理負荷分散、キャッシュによるネットワークの負荷軽減、どのサーバがリソースを保持しているかといった情報の秘匿化を実現できる。
また、これに加えて、ローカルネットワークにおいてはHTTPでの通信を強要しないため、HTTPとその他の通信プロトコル間の翻訳といった機能も実現できる。
\item トンネル\\
トンネルは通信内容の変更を行わず、二つの接続をただ中継するようにふるまう。
これにより、認証を必要とする通信において、認証成功後にトンネルを作成しておくことでその経路の通信を確立しておくことができる。
また、上記のプロキシとゲートウェイと異なり、トンネル自体はキャッシュを保有していない。
\end{enumerate}

\subsection{HTTP Over TLS}
\label{sec:https}
HTTP Over TLS\cite{https}（以下、「HTTPS」とする）は、簡単に通信内容を傍受される可能性のあるHTTPを拡張し、安全性を向上させた暗号通信プロトコルである。
HTTPに以下の機能を持つSecure Socket Layer/Transport Layer Security(SSL/TLS)を加えることで通信の安全性を確保している。
\begin{itemize}
\item 通信内容の暗号化
\item 通信相手の認証
\item 通信内容の改ざんの検出
\end{itemize}

\section{関連研究}

\end{document}
